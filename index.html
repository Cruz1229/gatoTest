<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Gato en Realidad Aumentada</title>
    <style>
        /* Estilos anteriores */
    </style>
</head>
<body>
    <div id="info">Apunta la cámara hacia un <a href="https://arjs-craftified.glitch.me/hiro-marker.png" target="_blank" style="color: #4CAF50; text-decoration: none;">marcador Hiro</a> para comenzar</div>
    <div id="turnoInfo" role="status" aria-live="polite">Turno: Jugador X</div>
    <button id="resetButton" aria-label="Reiniciar juego">Reiniciar Juego</button>
    <div id="errorMessage">Error al acceder a la cámara. Asegúrate de dar permisos y usar un navegador compatible como Chrome o Firefox.</div>
    <button id="startButton">Iniciar Juego AR</button>

    <div id="arContainer" style="display: none;"></div>

    <script>
        // Variables globales
        let currentPlayer = 'X';
        let gameBoard = ['', '', '', '', '', '', '', '', ''];
        let gameActive = true;
        let scene, marker, raycaster, mouse;
        const cells3D = [];
        let xGeometry, oGeometry;

        // Función para iniciar el juego
        document.getElementById('startButton').addEventListener('click', function() {
            this.style.display = 'none';
            initializeAR();
        });

        function initializeAR() {
            if (location.protocol !== 'https:') {
                showError('Esta aplicación requiere HTTPS. Por favor usa un servidor seguro.');
                return;
            }

            loadScript('https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js', function() {
                loadScript('https://aframe.io/releases/1.2.0/aframe.min.js', function() {
                    loadScript('https://cdn.jsdelivr.net/npm/@ar-js/core@latest/aframe/build/aframe-ar.js', function() {
                        createARScene();
                    });
                });
            });
        }

        function loadScript(url, callback) {
            const script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = url;
            script.onload = callback;
            script.onerror = function() {
                showError('Error al cargar recursos. Verifica tu conexión a internet.');
            };
            document.head.appendChild(script);
        }

        function createARScene() {
            const arContainer = document.getElementById('arContainer');
            arContainer.style.display = 'block';

            const sceneEl = document.createElement('a-scene');
            sceneEl.setAttribute('embedded', '');
            sceneEl.setAttribute('arjs', 'sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;');

            const markerEl = document.createElement('a-marker');
            markerEl.setAttribute('preset', 'hiro');
            markerEl.setAttribute('id', 'hiroMarker');

            const cameraEl = document.createElement('a-entity');
            cameraEl.setAttribute('camera', '');

            sceneEl.appendChild(markerEl);
            sceneEl.appendChild(cameraEl);
            arContainer.appendChild(sceneEl);

            sceneEl.addEventListener('loaded', function() {
                console.log('Escena AR cargada correctamente');
                onSceneLoaded();
            });

            sceneEl.addEventListener('camera-error', function() {
                showError('Error al acceder a la cámara. Asegúrate de dar permisos.');
            });
        }

        // Resto del código...
    </script>
</body>
</html>