<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Cuadrícula 3x3 en Realidad Aumentada</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/three.js/build/ar.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <script>
        // Variables globales
        let scene, camera, renderer;
        let arToolkitSource, arToolkitContext, markerRoot;

        // Inicializar
        function initialize() {
            // Crear escena, cámara y renderer
            scene = new THREE.Scene();
            camera = new THREE.Camera();
            scene.add(camera);
            
            renderer = new THREE.WebGLRenderer({
                antialias: true,
                alpha: true
            });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.domElement.style.position = 'absolute';
            renderer.domElement.style.top = '0px';
            renderer.domElement.style.left = '0px';
            document.body.appendChild(renderer.domElement);
            
            // Configurar AR.js
            arToolkitSource = new THREEx.ArToolkitSource({
                sourceType: 'webcam',
            });
            
            arToolkitSource.init(function onReady() {
                onResize();
            });
            
            window.addEventListener('resize', onResize);
            
            // Crear contexto AR
            arToolkitContext = new THREEx.ArToolkitContext({
                cameraParametersUrl: 'https://raw.githack.com/AR-js-org/AR.js/master/data/data/camera_para.dat',
                detectionMode: 'mono',
                maxDetectionRate: 30,
                canvasWidth: 80*3,
                canvasHeight: 60*3,
            });
            
            arToolkitContext.init(function onCompleted() {
                camera.projectionMatrix.copy(arToolkitContext.getProjectionMatrix());
            });
            
            // Crear marcador
            markerRoot = new THREE.Group();
            scene.add(markerRoot);
            
            let markerControls = new THREEx.ArMarkerControls(arToolkitContext, markerRoot, {
                type: 'pattern',
                patternUrl: 'https://raw.githack.com/AR-js-org/AR.js/master/data/data/patt.hiro',
            });
            
            // Crear la cuadrícula 3x3
            crearCuadriculaTresXTres();
            
            // Animar
            animate();
        }
        
        // Crear la cuadrícula 3x3
        function crearCuadriculaTresXTres() {
            // Fondo blanco
            const fondoGeometria = new THREE.PlaneGeometry(2, 2);
            const fondoMaterial = new THREE.MeshBasicMaterial({ 
                color: 0xffffff, 
                side: THREE.DoubleSide 
            });
            const fondo = new THREE.Mesh(fondoGeometria, fondoMaterial);
            fondo.rotation.x = -Math.PI/2; // Rotando para que sea horizontal
            markerRoot.add(fondo);
            
            // Líneas de la cuadrícula
            crearLineas();
            
            // Celdas de la cuadrícula (opcional)
            crearCeldas();
        }
        
        // Crear las líneas de la cuadrícula
        function crearLineas() {
            const lineasMaterial = new THREE.LineBasicMaterial({ color: 0x000000, linewidth: 2 });
            
            // Líneas horizontales
            for (let i = -2/3; i <= 2/3; i += 2/3) {
                const geometria = new THREE.BufferGeometry().setFromPoints([
                    new THREE.Vector3(-1, 0, i),
                    new THREE.Vector3(1, 0, i)
                ]);
                const linea = new THREE.Line(geometria, lineasMaterial);
                markerRoot.add(linea);
            }
            
            // Líneas verticales
            for (let i = -2/3; i <= 2/3; i += 2/3) {
                const geometria = new THREE.BufferGeometry().setFromPoints([
                    new THREE.Vector3(i, 0, -1),
                    new THREE.Vector3(i, 0, 1)
                ]);
                const linea = new THREE.Line(geometria, lineasMaterial);
                markerRoot.add(linea);
            }
        }
        
        // Crear las celdas individuales (opcional)
        function crearCeldas() {
            const tamanoCelda = 0.6;
            const celdaMaterial = new THREE.MeshBasicMaterial({ 
                color: 0xf0f0f0, 
                transparent: true,
                opacity: 0.5,
                wireframe: true
            });
            
            for (let x = -2/3; x <= 2/3; x += 2/3) {
                for (let z = -2/3; z <= 2/3; z += 2/3) {
                    const celdaGeometria = new THREE.PlaneGeometry(tamanoCelda, tamanoCelda);
                    const celda = new THREE.Mesh(celdaGeometria, celdaMaterial);
                    celda.rotation.x = -Math.PI/2; // Rotando para que sea horizontal
                    celda.position.set(x, 0.01, z); // Ligeramente arriba del plano principal
                    markerRoot.add(celda);
                }
            }
        }
        
        // Función para redimensionar
        function onResize() {
            arToolkitSource.onResizeElement();
            arToolkitSource.copyElementSizeTo(renderer.domElement);
            if (arToolkitContext.arController !== null) {
                arToolkitSource.copyElementSizeTo(arToolkitContext.arController.canvas);
            }
        }
        
        // Función de animación
        function animate() {
            requestAnimationFrame(animate);
            
            if (arToolkitSource.ready !== false) {
                arToolkitContext.update(arToolkitSource.domElement);
            }
            
            renderer.render(scene, camera);
        }
        
        // Iniciar todo
        window.onload = initialize;
    </script>
</body>
</html>